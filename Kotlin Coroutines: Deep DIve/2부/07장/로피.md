# 7ì¥ ì½”ë£¨í‹´ ì»¨í…ìŠ¤íŠ¸

```kotlin
public fun CoroutineScope.launch(
	context: CoroutineContext = EmptyCoroutineContext,
	start: CoroutineStart = CoroutineStart.Default,
	block: suspend CoroutineScope.() -> Unit
): Job
```

```kotlin
public interface CoroutineScope {
	public val coroutineContext: CoroutineContext
}
```

```kotlin
public interface Continuation<in T> {
	public val context: CoroutineContext
	public fun resumeWith(result: Result<T>)
}
```

ì½”í‹€ë¦° ì½”ë£¨í‹´ì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ ìš”ì†Œë“¤ì´ CoroutineContextë¥¼ ì‚¬ìš©í•˜ê³  ìˆë‹¤.

## CoroutineContext ì¸í„°í˜ì´ìŠ¤

CoroutinContext 

- ì›ì†Œë‚˜ ì›ì†Œë“¤ì˜ ì§‘í•©ì„ ë‚˜íƒ€ë‚´ëŠ” ì¸í„°í˜ì´ìŠ¤
- Job, CoroutineName, CoroutineDispatcherì™€ ê°™ì€ Element ê°ì²´ë“¤ì´ ì¸ë±ì‹±ëœ ì§‘í•©(ì»¬ë ‰ì…˜ì´ë‘ ê°œë…ì´ ë¹„ìŠ·)
- ê° Element ë˜í•œ CoroutineContextì´ë‹¤. â†’ ì»¬ë ‰ì…˜ ë‚´ ëª¨ë“  ì›ì†ŒëŠ” ê·¸ ìì²´ë§Œìœ¼ë¡œ ì»¬ë ‰ì…˜ì´ë¼ í•  ìˆ˜ ìˆë‹¤.
- ì»¨í…ìŠ¤íŠ¸ì—ì„œ ëª¨ë“  ì›ì†ŒëŠ” ì‹ë³„í•  ìˆ˜ ìˆëŠ” ìœ ì¼í•œ Keyë¥¼ ê°€ì§€ê³  ìˆë‹¤.
- ê° KeyëŠ” ì£¼ì†Œë¡œ ë¹„êµê°€ ëœë‹¤.

```kotlin
fun main() {
	val name: CoroutineName = CoroutineName("A name")
	val element: CoroutineContext.Element = name
	val context: CoroutineContext = element

	val job: Job = Job()
	val jobElement: CoroutineContext.Element = job
	val jobContext: CoroutineContext = jobElement
}
```

## CoroutineContextì—ì„œ ì›ì†Œ ì°¾ê¸°

- ì»¬ë ‰ì…˜ê³¼ ë¹„ìŠ·í•˜ê¸° ë•Œë¬¸ì— getì„ ì´ìš©í•´ ìœ ì¼í•œ í‚¤ë¥¼ ê°€ì§„ ì›ì†Œë¥¼ ì°¾ì„ ìˆ˜ ìˆë‹¤.
- ëŒ€ê´„í˜¸ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ë„ ê°€ëŠ¥í•˜ë‹¤. ì½”í‹€ë¦°ì—ì„œ get ë©”ì„œë“œê°€ ì—°ì‚°ìì´ê¸° ë•Œë¬¸ì— ëª…ì‹œì ì¸ í•¨ìˆ˜ í˜¸ì¶œ ëŒ€ì‹  ëŒ€ê´„í˜¸ë¥¼ ì‚¬ìš©í•´ ì‹¤í–‰í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì´ë‹¤.
- ì›ì†Œê°€ ì»¨í…ìŠ¤íŠ¸ì— ìˆìœ¼ë©´ ë°˜í™˜ë˜ê³  ì—†ìœ¼ë©´ nullì´ ëŒ€ì‹  ë°˜í™˜ëœë‹¤.

```kotlin
fun main() {
	val ctx: CoroutineContext = CoroutineName("A name")
	
	val coroutineName: CoroutineName? = ctx[CoroutineName]
	// or ctx.get(CoroutineName)
	println(coroutineName?.name) // A name
	val job: Job? = ctx[Job]     // or ctx.get(Job)
	println(job)                 // null
}
```

<aside>
ğŸ’¡ CoroutineContextëŠ” kotlin.coroutinesì—ì„œ ì„í¬íŠ¸ ëœë‹¤.
Jobì´ë‚˜ CoroutineNameê³¼ ê°™ì€ ì»¨í…ìŠ¤íŠ¸ëŠ” kotlinx.coroutinesì—ì„œ ì„í¬íŠ¸ ë˜ì–´ì•¼ í•œë‹¤.

</aside>

CoroutineNameì„ ì°¾ê¸° ìœ„í•´ì„œëŠ” CoroutineNameì„ ì‚¬ìš©í•˜ê¸°ë§Œ í•˜ë©´ ëœë‹¤.

CoroutineNameì€ íƒ€ì…ì´ë‚˜ í´ë˜ìŠ¤ê°€ ì•„ë‹Œ ì»´íŒ¨ë‹ˆì–¸ ê°ì²´ì´ë‹¤.

```kotlin
data class CoroutineName(
	val name: String
) : AbstactCoroutineContextElement(CoroutineName) {
	
	override fun toString(): String = "CoroutineName($name)"
	
	companion object Key : CoroutineContext.Key<CoroutineName>
} 
```

## ì»¨í…ìŠ¤íŠ¸ ë”í•˜ê¸°

CoroutineContext ìœ ìš©í•œ ê¸°ëŠ¥

- ë‘ ê°œì˜ CoroutineContextë¥¼ í•©ì³ í•˜ë‚˜ì˜ CoroutineContextë¡œ ë§Œë“¤ ìˆ˜ ìˆë‹¤.
- ë‹¤ë¥¸ í‚¤ë¥¼ ê°€ì§„ ë‘ ì›ì†Œë¥¼ ë”í•˜ë©´ ë§Œë“¤ì–´ì§„ ì»¨í…ìŠ¤íŠ¸ëŠ” ë‘ ê°€ì§€ í‚¤ë¥¼ ëª¨ë‘ ê°€ì§„ë‹¤.

```kotlin
fun main() {
	val ctx1: CoroutineContext = CoroutineName("Name1")
	println(ctx1[CoroutineName]?.name) // Name1
	println(ctx1[Job]?.isActive)       // null
	
	val ctx2: CoroutineContext = Job()
	println(ctx2[CoroutineName]?.name) // null
	println(ctx2[Job]?.isActive)       // 'Active' ìƒíƒœì´ë¯€ë¡œ true
	// ë¹Œë”ë¥¼ í†µí•´ ìƒì„±ë˜ëŠ” ì¡ì˜ ê¸°ë³¸ ìƒíƒœê°€ 'Active' ìƒíƒœì´ë¯€ë¡œ true

	val ctx3 = ctx1 + ctx2
	println(ctx3[CoroutineName]?.name) // Name1
	println(ctx3[Job]?.isActive).      // true
}
```

CoroutinContextì— ê°™ì€ í‚¤ë¥¼ ê°€ì§„ ë˜ ë‹¤ë¥¸ ì›ì†Œê°€ ë”í•´ì§€ë©´ ìƒˆë¡œìš´ ì›ì†Œê°€ ê¸°ì¡´ ì›ì†Œë¥¼ ëŒ€ì²´í•œë‹¤.

```kotlin
fun main() {
	val ctx1: CoroutineContext = CoroutineName("Name1")
	println(ctx1[CoroutineName]?.name) // Name1
	
	val ctx2: CoroutineContext = CoroutineName("Name2")
	println(ctx2[CoroutineName]?.name) // Name2 

	val ctx3 = ctx1 + ctx2
	println(ctx3[CoroutineName]?.name) // Name2
```

## ë¹„ì–´ ìˆëŠ” ì½”ë£¨í‹´ ì»¨í…ìŠ¤íŠ¸

CoroutineContext

- ì»¬ë ‰ì…˜ì´ë¯€ë¡œ ë¹ˆ ì»¨í…ìŠ¤íŠ¸ë¡œ ë§Œë“¤ ìˆ˜ ìˆë‹¤.
    - ë¹ˆ ì»¨í…ìŠ¤íŠ¸ëŠ” ì›ì†Œê°€ ì—†ìœ¼ë¯€ë¡œ, ë‹¤ë¥¸ ì»¨í…ìŠ¤íŠ¸ì— ë”í•´ë„ ì•„ë¬´ëŸ° ë³€í™”ê°€ ì—†ë‹¤.

```kotlin
fun main() {
	val empty: CoroutineContext = EmptyCoroutineContext
	println(empty[CoroutineName]) // null
	println(empty[Job])           // null

	val ctxName = empty + CoroutineName("Name1") + empty
	println(ctxName[CoroutineName]) // CoroutineName(Name1)
```

## ì›ì†Œ ì œê±°

minusKey í•¨ìˆ˜ì— í‚¤ë¥¼ ë„£ëŠ” ë°©ì‹ìœ¼ë¡œ ì›ì†Œë¥¼ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì œê±°í•  ìˆ˜ ìˆë‹¤.

```kotlin
fun main() {
	val ctx = CoroutineName("Name1") + Job()
	println(ctx[CoroutineName]?.name) // Name1
	println(ctx[Job]?.isActive)       // true

	val ctx2 = ctx.minusKey(CoroutineName)
	println(ctx2[CoroutineName]?.name) // null
	println(ctx2[Job]?.isActive)       // true

	val ctx3 = (ctx + CoroutineName("Name2"))
		.minusKey(CoroutineName)
	println(ctx3[CoroutineName]?.name) // null
	println(ctx3[Job]?.isActive)       // true
}
```

## ì»¨í…ìŠ¤íŠ¸ í´ë”©

ì»¨í…ìŠ¤íŠ¸ì˜ ê° ì›ì†Œë¥¼ ì¡°ì‘í•´ì•¼ í•˜ëŠ” ê²½ìš° fold ë©”ì„œë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

fold ë©”ì„œë“œì— í•„ìš”í•œ ìš”ì†Œ

- ëˆ„ì‚°ê¸°ì˜ ì²« ë²ˆì§¸ ê°’
- ëˆ„ì‚°ê¸°ì˜ í˜„ì¬ ìƒíƒœì™€ í˜„ì¬ ì‹¤í–‰ë˜ê³  ìˆëŠ” ì›ì†Œë¡œ ëˆ„ì‚°ê¸°ì˜ ë‹¤ìŒ ìƒíƒœë¥¼ ê³„ì‚°í•  ì—°ì‚°

```kotlin
fun main() {
	val ctx = CoroutineName("Name1") + Job()

	ctx.fold("") { acc, element -> "$acc$element "}
		.also(::println)
	// CoroutineName(Name1) JobImpl{Active}@dbab622e

	val empty = emptyList<CoroutineContext>()
	ctx.fold(empty) { acc, element -> acc + element }
		.joinToString()
		.also(::println)
	// CoroutineName(Name1), JobImpl{Active}@dbab662e
```

## ì½”ë£¨í‹´ ì»¨í…ìŠ¤íŠ¸ì™€ ë¹Œë”

CoroutineContextëŠ” ì½”ë£¨í‹´ì˜ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ì „ë‹¬í•˜ëŠ” ë°©ë²•ì´ë‹¤.

ë¶€ëª¨ëŠ” ê¸°ë³¸ ì ìœ¼ë¡œ ì»¨í…ìŠ¤íŠ¸ë¥¼ ìì‹ì—ê²Œ ì „ë‹¬í•œë‹¤. ìì‹ì€ ë¶€ëª¨ë¡œë¶€í„° ì»¨í…ìŠ¤íŠ¸ ìƒì†ë°›ëŠ”ë‹¤.

```kotlin
fun CoroutineScope.log(msg: String) {
	val name = coroutineContext[CoroutineName]?.name
	println("[$name] $msg")
}

fun main() = runBlocking(CoroutineName("main")) {
	log("Started") // [main] Started
	val v1 = async {
		delay(500)
		log("Running async") // [main] Running async
		42
	}
	launch {
		delay(1000)
		log("Running launch")
	}
	log("The answer is ${v1.await()}")
	// [main] The answer is 42
}
```

ëª¨ë“  ìì‹ì€ ë¹Œë”ì˜ ì¸ìì—ì„œ ì •ì˜ëœ íŠ¹ì • ì»¨í…ìŠ¤íŠ¸ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆë‹¤. ì¸ìë¡œ ì „ë‹¬ëœ ì»¨í…ìŠ¤íŠ¸ëŠ” ë¶€ëª¨ë¡œë¶€í„° ìƒì†ë°›ì€ ì»¨í…ìŠ¤íŠ¸ë¥¼ ëŒ€ì²´í•œë‹¤.

```kotlin
fun main() = runBlocking(CoroutineName("main")) {
	log("Started") // [main] Started
	val v1 = async(CoroutineName("c1")) {
		delay(500)
		log("Running async") // [c1] Running async
		42
	}
	launch(CoroutineName("c2")) {
		delay(1000)
		log("Running launch")
	}
	log("The answer is ${v1.await()}") // [c2] Running launch
	// [main] The answer is 42
```

> ì½”ë£¨í‹´ ì»¨í…ìŠ¤íŠ¸ ê³„ì‚° ê³µì‹

**defaultContext + parentContext + childContext**
> 

ìì‹ì˜ ì»¨í…ìŠ¤íŠ¸ëŠ” ë¶€ëª¨ë¡œë¶€í„° ìƒì†ë°›ì€ ì»¨í…ìŠ¤íŠ¸ ì¤‘ ê°™ì€ í‚¤ë¥¼ ê°€ì§„ ì›ì†Œë¥¼ ëŒ€ì²´í•œë‹¤. 

ë””í´íŠ¸ ì›ì†ŒëŠ” ì–´ë””ì„œë„ í‚¤ê°€ ì§€ì •ë˜ì§€ ì•Šì„ ë•Œë§Œ ì‚¬ìš©ëœë‹¤. í˜„ì¬ ë””í´íŠ¸ë¡œ ì„¤ì •ë˜ëŠ” ì›ì†ŒëŠ” **Dispatchers.Default**ì´ë©°, ì• í”Œë¦¬ì—í‚¤ì…˜ì´ ë””ë²„ê·¸ ëª¨ë“œì¼ ë•ŒëŠ” CoroutineIdë„ ë””í´íŠ¸ë„ ì„¤ì •ëœë‹¤.

Jobì€ ë³€ê²½ ê°€ëŠ¥í•˜ë©°, ì½”ë£¨í‹´ì˜ ìì‹ê³¼ ë¶€ëª¨ê°€ ì†Œí†µí•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” íŠ¹ë³„í•œ ì»¨í…ìŠ¤íŠ¸ì´ë‹¤.

## ì¤‘ë‹¨ í•¨ìˆ˜ì—ì„œ ì»¨í…ìŠ¤íŠ¸ì— ì ‘ê·¼í•˜ê¸°

ì¼ë°˜ì ì¸ ì¤‘ë‹¨ í•¨ìˆ˜ì—ì„œëŠ” ì–´ë–»ê²Œ ì»¨í…ìŠ¤íŠ¸ì— ì ‘ê·¼í•  ìˆ˜ ìˆì„ê¹Œ?

- ì»¨í…ìŠ¤íŠ¸ëŠ” ì¤‘ë‹¨ í•¨ìˆ˜ ì‚¬ì´ì— ì „ë‹¬ë˜ëŠ” ì»¨í‹°ë‰´ì—ì´ì…˜ ê°ì²´ê°€ ì°¸ì¡°í•˜ê³  ìˆê¸° ë•Œë¬¸ì— ì¤‘ë‹¨ í•¨ìˆ˜ì—ì„œ ë¶€ëª¨ì˜ ì»¨í…ìŠ¤íŠ¸ì— ì ‘ê·¼í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•˜ë‹¤.
- coroutineContext í”„ë¡œí¼í‹°ëŠ” ëª¨ë“  ì¤‘ë‹¨ ìŠ¤ì½”í”„ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•˜ë©°, ì´ë¥¼ í†µí•´ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.

```kotlin
suspend fun printName() {
	println(coroutineContext[CoroutineName]?.name)
}

suspend fun main() = withContext(CoroutineName("Outer")) {
	printName() // Outer
	launch(CoroutineName("Inner")) {
		printName() // Inner
	}
	delay(10)
	printName() // Outer
}
```

## ì»¨í…ìŠ¤íŠ¸ë¥¼ ê°œë³„ì ìœ¼ë¡œ ìƒì„±í•˜ê¸°

ì½”ë£¨í‹´ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì»¤ìŠ¤í…€í•˜ê²Œ ë§Œë“œëŠ” ë°©ë²•

- CoroutineContext.Element ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” í´ë˜ìŠ¤ë¥¼ ë§Œë“œëŠ” ê²ƒ
    - CoroutineContext.Key<*> íƒ€ì…ì˜ key í”„ë¡œí¼í‹°ë¥¼ í•„ìš”ë¡œ í•œë‹¤.
    
    ```kotlin
    // ë¶€ëª¨ì—ì„œ ìì‹ìœ¼ë¡œ ì „ë‹¬ë˜ê³  ìì‹ì€ ê°™ì€ í‚¤ë¥¼ ê°€ì§„ ë˜ ë‹¤ë¥¸ ì»¨í…ìŠ¤íŠ¸ë¡œ ì´ë¥¼ ëŒ€ì²´í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì—ì„œ
    // CoroutineNameê³¼ ì•„ì£¼ ë¹„ìŠ·í•˜ë‹¤.
    
    class MyCustomContext : CoroutineContext.Element {
    	
    	override val key: CoroutineContext.Key<*> = Key
    
    	companion object Key : 
    		CoroutineContext.Key<MyCustomContext>
    }
    ```
    
    ```kotlin
    class CounterContext(
    	private val name: String
    ) : CoroutineContext.Element {
    	
    	override val key: CoroutineContext.Key<*> = Key
    	private var nextNuber = 0
    
    	fun printNext() {
    		println("$name: $nextNumber")
    		nextNumber++
    	}
    	companion object Key: CoroutineContext.Key<CounterContext>
    }
    
    suspend fun printNext() {
    	coroutineContext[CounterContext]?.printNext()
    }
    
    suspend fun main(): Unit =
    	withContext(CounterContext("Outer")) {
    		printNext() // Outer: 0
    		launch {
    			printNext() // Outer: 1
    			launch {
    				printNext() // Outer: 2
    			}
    			launch(CounterContext("Inner")) {
    				printNext() // Inner: 0
    				printNext() // Inner: 1
    				launch {
    					printNext() // Inner: 2
    				}
    			}
    		}
    		printNext() // Outer: 3
    	}
    ```
    
    <aside>
    ğŸ’¡ ì»¤ìŠ¤í…€ ì»¨í…ìŠ¤íŠ¸ê°€ ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ë°©ë²•ì€ ì•„ë‹ˆë‹¤.
    
    </aside>
    

### ìš”ì•½

**CoroutineContext**

- ì»¬ë ‰ì…˜ê³¼ ê°œë…ì ìœ¼ë¡œ ë¹„ìŠ·
- Element ì¸í„°í˜ì´ìŠ¤ì˜ ì¸ë±ì‹±ëœ ì§‘í•©, Element ë˜í•œ CoroutineContextì´ë‹¤.
- ëª¨ë“  ì›ì†Œë¥¼ ì‹ë³„í•  ë•Œ ì‚¬ìš©ë˜ëŠ” ìœ ì¼í•œ keyë¥¼ ê°€ì§€ê³  ìˆë‹¤.
- ì½”ë£¨í‹´ì— ê´€ë ¨ëœ ì •ë³´ë¥¼ ê°ì²´ë¡œ ê·¸ë£¹í™”í•˜ê³  ì „ë‹¬í•˜ëŠ” ë³´í¸ì ì¸ ë°©ë²•ì´ë‹¤.
- ì½”ë£¨í‹´ì— ì €ì¥ë˜ë©°, ì½”ë£¨í‹´ì˜ ìƒíƒœê°€ ì–´ë–¤ì§€ í™•ì¸í•˜ê³ , ì–´ë–¤ ìŠ¤ë ˆë“œë¥¼ ì„ íƒí• ì§€ ë“± ì½”ë£¨í‹´ì˜ ì‘ë™ ë°©ì‹ì„ ì •í•  ìˆ˜ ìˆë‹¤.
