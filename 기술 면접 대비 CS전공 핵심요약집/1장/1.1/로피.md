# 1.1 운영체제

## 1.1.1 운영체제란

**운영체제**

- 하드웨어 위에 설치되어 하드웨어 계층과 다른 소프트웨어 계층을 연결하는 소프트웨어 계층
- **컴퓨터 시스템의 자원 관리**, **사용자가 컴퓨터를 사용할 수 있는 환경 제공**
- ex) 윈도우, 맥OS, 리눅스, 유닉스

## 1.1.2 운영체제의 목적

1. 처리 능력 향상
- OS는 자원 관리를 통해 일정 시간 내에 시스템이 처리하는 일의 양을 향상

1. 반환 시간 단축
- OS는 사용자가 시스템에 요청한 작업을 완료할 때까지 소요되는 시간 단축

1. 사용 가능도 향상
- 사용가능도 - 시스템 자원을 얼마나 빨리 제공할 수 있는가를 의미
- OS는 사용자가 컴퓨터를 사용해야 할 때 자원을 즉시 사용할 수 있게 함

1. 신뢰도 향상
- 신뢰도 - 시스템이 주어진 문제를 정확하게 푸는지 의미
- OS는 입력 값에 대한 정확한 결과 값을 줄 수 있도록 신뢰도 향상

## 1.1.3 CPU와 메모리 구조

**CPU(= 프로세서, 중앙 처리 장치) - Central Processing Unit**

- `컴퓨터의 뇌` 역할
- 컴퓨터에서 프로그램을 실행하는 데 필요한 연산을 처리하고 수행

**메모리**

- 데이터를 저장하기 위한 기억장치
- 주기억장치(휘발성 메모리) - 메인 메모리, RAM
- 보조기억장치(비휘발성 메모리) - SSD, HDD

![IMG_99F8908F0AAD-1.jpeg](https://github.com/team-replace/replace-android/assets/50761690/9caf1486-371b-4d28-9baa-eb3f8e4ed47c)

### 메모리의 계층 구조

- 레지스터(register)
    - CPU가 사용자 요청을 처리하는 데 필요한 데이터를 임시로 저장하는 기억장치
    - CPU 내부에 존재하며 접근 속도 빠름
    - 프로세서에 위치한 고속 메모리로, 프로세스가 바로 사용할 수 있는 데이터(소량의 데이터, 처리 중인 중간 결과 등)를 담고 있는 영역
- 캐시메모리(cache memory)
    - CPU와 RAM 사이의 속도 차이를 해결하기 위한 장치
    - CPU 내부에 위치, 접근 속도 레지스터 다음으로 빠름
    - 데이터나 값을 미리 복사해 놓는 임시 장소
    - 시스템의 효율성을 위해 사용
        - 캐시의 접근 시간에 비해 원래 데이터를 접근하는 시간이 오래 걸리는 경우
        - 값을 다시 계산하는 시간을 절약하고 싶은 경우
- RAM(Random Access Memory)
    - 컴퓨터에서 프로그램을 실행할 때 필요한 정보 저장
    - 휘발성 기억 장치
    - 보통 메모리를 RAM이라고 함
    - `Random Access` : 어느 위치에서든 똑같은 속도로 접근하여 읽고 쓸 수 있다는 의미
- 하드 디스크(hard disk)
    - 사용자가 필요한 데이터와 프로그램을 저장
    - 비휘발성 기억장치

프로그램 작성 → 작성한 프로그램을 디스크에 저장 → 사용자가 운영체제에 프로그램의 실행을 요청 → OS가 디스크에 있는 프로그램을 메모리에 로드(프로그램을 메모리에 올려 공간 할당) → 메모리에 로드한 프로그램(프로세스)를 CPU가 처리

CPU는 하나의 프로세스만 처리가능 → 멀티 프로세스 환경에서는 OS가 스케줄링을 통해 CPU에 프로세스 할당

## 1.1.4 커널과 시스템 콜

**커널**

- OS 핵심요소
- 항상 메모리에 올라가 있는 운영체제의 핵심 부분
- 컴퓨터 하드웨어와 프로세스의 보안, 자원 관리, 하드웨어 추상화 같은 중요한 역할을 수행
- 자원 관리를 위해 CPU 스케줄링, 메모리 관리, 입출력 관리, 파일 시스템 관리 담당

  ![IMG_B79774433B70-1.jpeg](https://github.com/team-replace/replace-android/assets/50761690/98c97f7a-73e3-495b-8974-26ae4edbf082)


운영체제는 커널에서 관리하는 중요 자원에 사용자가 쉽게 접근하지 못하도록 **커널모드**와 **사용자모드**로 나눔

- 프로세스가 실행되는 동안 유저 모드와 커널 모드를 반복적으로 넘나듬
- 커널모드(kernel mode)
    - 하드웨어 직접 접근해 메모리, CPU와 같은 자원 사용 가능
- 사용자모드(user mode)
    - 사용자 영역의 응용프로그램이 사용하는 모드
    - 커널 모드의 자원에 접근할 수 없게 제한을 둠
    - 실행된 프로세스가 자원에 접근하려면 시스템 콜을 호출해 커널에 요청해야함
        - 시스템 콜 - 사용자 모드에서 커널 모드에 접근해 필요한 기능을 수행할 수 있게 하는 시스템
            - 프로세스 제어, 파일 조작, 장치 관리, 데이터의 유지 보수, 통신 보호를 할 수 있음
            - System call 호출 시 일시적으로 커널 모드로 전환
            - ex) 프로세스를 생성하는 fork(), 부모 프로세스가 자식 프로세스의 수행을 기다리는 wait()
    - 커널은 시스템 콜로 받은 요청을 처리한 후 다시 시스템 콜로 결과 값 반환

![IMG_2B88A4E29D88-1.jpeg](https://github.com/team-replace/replace-android/assets/50761690/53ff22a5-7044-4ff0-a853-58f88330b6f6)

시스템 콜에서 커널에 매개변수를 전달하는 방법

- 필요한 기능이나 시스템 환경에 따라 System call이 발생할 때 좀 더 많은 정보가 필요할 수 있다.
1. 매개변수를 CPU의 레지스터에 직접 전달하는 방식
    - 매개변수의 개수가 레지스터의 개수보다 많은 경우에 문제가 될 수 있음
2. 매개변수를 메모리에 저장한 후 메모리의 주소 값을 레지스터에 저장하는 방식
3. 매개변수를 프로그램의 스택(stack)에 push하고 OS에서 pop해 매개변수를 전달하는 방식

**시스템 콜 필요한 이유**

- **User가 에플리케이션으로 OS의 치명적인 데이터를 수정/삭제하는 권한을 막기 위해서**다.
- 유저 애플리케이션이 system call을 호출하여 사용하면 해당 애플리케이션은 커널모드로 잠시 전환되는 작업을 거치게 되며, **커널 모드를 통한 이러한 작업은 반드시 시스템 콜을 통해 수행하도록 설계되어 있다.**

### System Call 수행 과정

![Untitled](https://github.com/team-replace/replace-android/assets/50761690/f24d9627-c8c9-4ca1-9266-a1e5cde02587)

1. 프로세스가 System Call을 호출하면 trap이 발생하여 kernel mode로 진입
2. 요청이 들어온 System Call을 수행
3. return-from-trap을 발생시켜 user mode로 돌아간다.
