## 1.6 캐시 메모리

### 1.6.1 캐시 메모리와 지역성
- CPU와 메인 메모리 간에 데이터 접근 시 속도 차이를 줄이기 위해 사용한다.
- CPU에서 메인 메모리에 있는 데이터를 가져올 때 자주 사용하는 데이터는 캐시에 저장한다.
- 캐시에 데이터를 저장할 때는 지역성을 바탕으로 한다.
- 지역성은 CPU가 자주 참조하는 데이터가 고르게 분포되지 않고 특정 부분에 몰려 있는 것을 말한다.
    - 시간 지역성 : 최근에 참조한 데이터를 다시 참조할 가능성이 높다.
    - 공간 지역성 : 실제 참조한 주소 근처의 데이터를 다시 참조할 가능성이 높다.

<br><br>

### 1.6.2 캐시 메모리의 매핑 방식
- 이 메모리가 캐시에 올라가게 되면 어떤 위치에 저장되어야 하는지 등록되어 있다.

- 직접 매핑(Directed Mapped Cache)
    - 메인 메모리를 일정한 크기로 나누고 각 영역을 캐시 메모리에 매핑하는 방식이다.
    - 메인 메모리는 캐시 메모리보다 크므로 나눠진 n개의 메모리 영역이 1개의 캐시 메모리에 매핑된다.

- 연관 매핑
    - 메모리 영역을 캐시 메모리에 규칙 없이 매핑하는 방식이다.
    - 메모리 영역을 캐시 메모리에 적재할 때는 간단하지만 캐시 메모리에서 필요한 메모리 영역을 찾을 떄는 비효율적이다.

- 집합 연관 매핑(N-way Set Associative Caches)
    - 직접 매핑과 연관 매핑을 결합해 단점을 보완한 방식으로 범용적으로 사용된다.

<br>

**예시**
- 캐시는 8개의 데이터가 들어갈 수 있고, 메인 메모리는 32개의 데이터가 들어갈 수 있다고 가정한다.
- 라인을 식별하기 위해 캐시는 3bit가 필요하다.

- 직접 매핑(Directed Mapped Cache)
    - 뒤의 3bit를 보고 올라갈 위치를 지정한다.
    - 캐시의 한 자리에 올라올 수 있는 후보는 4개다. (e.g 000이면 00000, 01000, 10000, 11000) 그래서 2bit를 사용하여 태그를 달면 어떤 데이터가 캐시에 적재되어 있는 것인지 알 수 있다.
        - (1) D에 접근하여 데이터를 가져오면 캐시의 011라인에 저장하고 앞의 2bit를 태그로 만든 뒤 값이 유효하니 Valid 비트를 1로 변경한다.
        - (2) E에 접근하여 데이터를 가져오면 캐시의 110라인에 저장하고 앞의 2bit를 태그로 만든 뒤 값이 유효하니 Valid 비트를 1로 변경한다.
        - (3) B에 접근하여 데이터를 가져오면 캐시의 100라인에 저장하고 앞의 2bit를 태그로 만든 뒤 값이 유효하니 Valid 비트를 1로 변경한다.
        - (4) C에 접근하여 데이터를 가져오면 캐시의 110라인에 저장하고 앞의 2bit를 태그로 만든다. 이미 값이 있더라도 덮어 쓴다.
<center><img src="https://github.com/woowacourse-study/2023-cs-study/assets/84285337/df64594e-ccac-455d-a8ac-642c6294d877" width=500></center>

- 집합 연관 방식(N-way Set Associative Caches)
    - 캐시의 라인 2개를 하나의 슬롯으로 바라본다. 8개의 슬롯에서 4개의 슬롯으로 줄어든다.
    - 슬롯의 개수가 줄어든만큼 들어올 수 있는 데이터는 많아진다. (4개 -> 8개)
    - 태그를 3bit로 사용하면 구분할 수 있다.
        - (1) D에 접근하여 데이터를 가져오면 캐시의 11라인에 저장하고 앞의 3bit를 태그로 만든 뒤 값이 유효하니 Valid 비트를 1로 변경한다.
        - (2) E에 접근하여 데이터를 가져오면 캐시의 10라인에 저장하고 앞의 3bit를 태그로 만든 뒤 값이 유효하니 Valid 비트를 1로 변경한다.
        - (3) B에 접근하여 데이터를 가져오면 캐시의 00라인에 저장하고 앞의 3bit를 태그로 만든 뒤 값이 유효하니 Valid 비트를 1로 변경한다.
        - (4) C에 접근하여 데이터를 가져오면 캐시의 10라인에 저장하고 앞의 3bit를 태그로 만든다. 같은 슬롯을 사용하고 있지만 빈 자리가 있기 때문에 저장할 수 있다.
<center><img src="https://github.com/woowacourse-study/2023-cs-study/assets/84285337/73da1e51-150e-44b1-b7eb-c301673fac12" width=500></center>

<br><br>

<img src="" width=500> 