# 1.5 가상 메모리

## 가상 메모리 (virtual memory)

- 프로세스의 일부만 메모리에 로드하고, 나머지는 디스크에 둔 상태로 프로세스를 실행하는 방식
- 메모리에 프로세스 일부를 로드하고, 나머지 영역은 디스크에 둠으로써 더 많은 프로세스를 메모리에 로드
- 장점
    - 프로그램이 메모리 크기에 대한 제약을 덜 받을 수 있음
    - 동시에 많은 프로그램을 실행하므로 CPU 이용률과 처리율을 높일 수 있음
    - 필요한 영역만 메모리에 로드해 스와핑 횟수를 줄여서 프로그램 실행 속도 높일 수 있음

## 요구 페이징 (demand paging)

- 프로세스에서 필요한 페이지만 메모리에 로드하는 방식
    - 필요하지 않은 페이지는 디스크에 저장
- 초기에 필요한 영역만 메모리에 로드한 후, 다른 영역은 요청이 올 때 메모리에 로드
- `페이지 폴트 (page fault)`
    - 물리 메모리에 필요한 페이지가 없는 경우
    - 페이지 폴트 발생 → 디스크에서 필요한 페이지 **스왑 인**
    - 페이지에 해당하는 메모리 영역이 물리 메모리에 있는지 페이지 테이블을 통해 파악
        - 페이지 테이블은 페이지에 해당하는 프레임이 존재하면 `v`, 존재하지 않거나 유효하지 않으면 `i` 반환
    
    ![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/d4809f18-a915-4e30-8b11-8f015eacff00/12df8218-d2fa-4d39-8218-e6a70885dfcf/Untitled.png)
    

## 스레싱 (thrashing)

- 동시에 일정 수 이상의 프로그램을 실행했을 때, 오히려 CPU 이용률이 떨어지는 상황
- 가상 메모리를 구현해 다중 프로그래밍 → CPU 이용률 높아짐
- 하지만 일정 수 이상으로 다중 프로그래밍을 하면 **페이지 폴트가 자주 발생**
    
    → 스왑 인, 스왑 아웃 작업이 많아짐 → CPU 이용률이 떨어짐
    

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/d4809f18-a915-4e30-8b11-8f015eacff00/15ddbfa4-3031-404a-926d-470a3ff4a31e/Untitled.png)

### working set

- 스레싱을 예방하는 방법
- 지역성을 기반으로 자주 사용하는 페이지를 저장해 두는 것
- 페이지 폴트가 빈번하게 발생하는 현상 방지