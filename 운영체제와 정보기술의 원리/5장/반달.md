# 5장 | 프로세스 관리

## 1. 프로세스의 개념

- 프로세스 - 실행중인 프로그램(program in execution)을 뜻한다.
- 잡(job)이라는 용어와 프로세스를 혼용해서 사용한다.
- 프로세스 문맥 - 프로세스가 현재 어떤 상태에서 수행되고 있는지 정확히 규명하기 위해 필요한 정보를 의미
    - 프로세스의 주소 공간, 레지스터가 어떤 값을 가지고 있었는지, 시스템 콜 등을 통해 커널에서 수행한 일의 상태, 프로세스에 관해 커널이 관리하고 있는 각종 정보 등을 포함
    - 크게 세 가지로 분류
        - 하드웨어 문맥 - CPU의 수행상태
        - 프로세스의 주소 공간 - 코드 , 데이터, 스택으로 구성된 자신만의 독자적인 주소공간을 가짐
        - 커널상의 문맥

## 2. 프로세스의 상태

- 실행(running) - 프로세스가 CPU를 보유하고, 기계어 명령을 실행하고 있는 상태를 가리킴
- 준비(ready) - 프로세스가 CPU만 보유하면 바로 실행할 수 있지만 CPU를 할당 받지 못한 상태
- 봉쇄(blocked, wait, sleep) - CPU를 할당받더라도 당장 명령을 실행할 수 없는 프로세스의 상태
    - 입출력 작업이 진행 중인 경우
- 시작(new) - 프로세스가 시작되어 그 프로세스를 위한 각종 자료구조는 생성되었지만 아직 메모리 획득 승인을 받지 못한 상태
- 완료(terminated) - 프로세스가 종료되었으나 운영체제가 그 프로세스와 관련된 자료구조를 완전히 정리하지 못한 상태
- 상태를 왜 구분해 놓았을까? - 컴퓨터 자원을 효율적으로 관리하기 위해서
- 준비상태에 있는 프로세스 들 중에서 CPU를 할당받을 프로세스를 선택 후 실제로 CPU의 제어권을 넘겨받는 과정을 CPU 디스패치(dispatch)라고 한다.

## 3 프로세스 제어블록

프로세스 제어블록(Process Control Block: PCB) - 운영체제가 시스템 내의 프로세스들을 관리하기 위해 프로세스마다 유지하는 정보들을 담는 커널 내의 자료구조

- 프로세스의 상태(process state) - CPU를 할당해도 되는지 여부를 결정하기 위해 필요
- 프로그램 카운터(program counter) - 다음에 수행할 명령의 위치를 가리킴
- CPU 레지스터(CPU register)의 값 - CPU 연산을 위해 현 시점에 레지스터에 어떤 값을 저장하고 있었는지
- CPU 스케줄링 정보(CPU scheduling information) - 프로세스의 CPU 스케줄링을 위해 필요한 정보
- 메모리 관리 정보(memory management information) - 프로세스의 메모리 관리를 위해 필요한 정보
- 자원 사용 정보(accounting information) - 사용자에게 자원 사용 요금을 계산해 청구
- 입출력 상태 정보(I/O status information) - 프로세스가 오픈한 파일 정보 등 프로세스의 입출력 관련 상태정보를 나타냄

## 4. 문맥교환

- 문맥교환(context switch) - 하나의 사용자 프로세스로부터 다른 사용자 프로세스로 CPU의 제어권이 이양되는 과정
- 문맥교환은 타이머 인터럽트가 발생하는 경우 외에 실행 중이던 프로세스가 입출력 요청이나 다른 조건을 충족하지 못해 CPU를 회수당하고 봉쇄 상태가 되는 경우에도 발생할 수 있다.
- 문맥교환에 소요되는 시간은 시스템 입장에서 볼 때 일종의 오버헤드라고 할 수 있다.
- 이는 문맥 교환 중에 일어나는 작업이 실제 시스템에게 유용한 작업이 아니기 때문이다.
- 타이머에 CPU 할당시간을 아주 작게 세팅해 프로세스 간 문맥교환이 빈번하게 발생하도록 하면 이에 드는 오버헤드가 상당히 커진다.
- 하지만 반대로 CPU 할당시간을 너무 크게 설정하면 시분할시스템의 의미가 퇴색하게 되므로 적절한 CPU 할당시간을 정하는 것이 중요하다.

## 5. 프로세스를 스케줄링하기 위한 큐

- 운영체제는 준비 상태에 있는 프로세스들을 줄 세우기 위해 준비 큐(ready queue)를 두고 준비 큐의 제일 앞에 줄 서 있는 프로세스에 제일 먼저 CPU를 할당한다.
- 장치 큐(device queue) - 운영체제는 특정 자원을 기다리는 프로세스들을 줄 세우기 위해 장치큐를 둔다.
- 작업 큐(job queue) - 시스템 내의 모든 프로세스를 관리하기 위한 큐, 프로세스 상태와 무관하게 현재 시스템 내에 있는 모든 프로세스가 작업 큐에 속하게 된다.

## 6. 스케줄러

- 스케줄러(scheduler) - 어떤 프로세스에게 자원을 할당할지를 결정하는 운영체제 커널의 코드를 지칭
- 장기 스케줄러(long term scheduler) - 작업 스케줄러(job scheduler)라고도 부르며, 어떤 프로세스를 준비 큐에 진입시킬지 결정하는 역할을 한다. 프로세스에게 메모리를 할당하는 문제에 관여함
- 단기 스케줄러(short term scheduler)- CPU 스케줄러라고도 하며, 준비 상태의 프로세스 중에서 어떤 프로세스를 다음번에 실행 상태로 만들 것이니 결정한다. 준비큐에 있는 여러 프로세스들 중 어떠한 프로세스에게 CPU를 할당할 것인가를 단기 스케줄러가 결정한다.
- 중기 스케줄러(medium term scheduling) - 현대의 시분할 시스템용 운영체제에서 장기대신 두는 스케줄러이다. 너무 많은 프로세스에게 메모리를 할당해 시스템의 성능이 저하되는 경우 이를 해결하기 위해 메모리에 적재된 프로세스의 수를 동적으로 조절하기 위해 추가된 스케줄러이다.

## 7. 프로세스의 생성

- 운영체제가 프로세스 전부를 생성하지 않는다.
- 시스템이 부팅된 후 최초의 프로세스는 운영체제가 직접 생성하지만 그다음부터는 이미 존재하는 프로세스가 다른 프로세스를 복제 생성한다.
- 부모 프로세스 - 프로세스를 생성한 프로세스
- 자식 프로세스 - 부모 프로세스가 생성한 프로세스
- 프로세스의 자발적 종료 - 프로세스가 마지막 명령을 수행한 후 운영체제에게 이를 알려 이루어지는 종료
    - 프로세스는 시스템 콜을 통해 운영체제에게 자신이 종료됨을 알림
- 프로세스의 비자발적 종료 - 부모 프로세스가  자식 프로세스의 수행을 강제로 종료
    1. 자식 프로세스가 할당 자원의 한계치를 넘어서는 많은 양의 자원을 요구할 떄
    2. 자식 프로세스에게 할당된 작업이 더 이상 필요하지 않을 때
    3. 부모 프로세스가 종료될 때

## 8. 프로세스 간의 협력

- 프로세스는 각자 자신만의 독립적인 주소 공간을 가지고 수행되며 원칙적으로 프로세스가 다른 프로세스의 수행에 영향을 끼칠 수 없다.
- 경우에 따라서는 독립적인 프로세스들이 협력할 때 업무의 효율성이 증진 될 수 있다.
- IPC(Inter-Process Communication) - 프로세스 간의 협력 매커니즘을 위해 운영체제가 제공하는 대표적인 매커니즘 , 하나의 컴퓨터 안에서 실행 중인 서로 다른 프로세스간에 발생하는 통신
    - 프로세스들 간의 통신과 동기화를 이루기 위한 매커니즘을 의미한다.
    - 대표적 방법으로 메시지 전달 (message passing), 공유메모리(shared memory) 방식이 있음
    - 차이점은 프로세스 사이에 공유 데이터를 사용하는가 그렇지 않는가에 있다.
    - 메시지 전달 - 프로세스 간에 공유 데이터를 일체 사용하지 않고 메시지를 주고받으면서 통신하는 방식
    - 공유메모리 - 프로세스들이 주소 공간의 일부르르 공유한다. 운영체제가 공유메모리를 사용하는 시스템 콜을 지원해, 서로 다른 프로세스들이 그들의 주소 공간 중 일부를 공유할 수 있도록 한다. 이러한 공유 메모리 영역은 각자의 주소 공간에 공통적으로 포함되느느 영역이므로 여러 프로세스가 읽고 쓰는 것이 가능하다.
        - 프로세스간의 통신을 수월하게 하는 인터페이스르르 제공하지만 서로의 데이터에 일관성 문제가 유발 될 수 있다. 이에 대해서는 커널이 책임지지 않기 때문에 프로세스들끼리 직접 공유메모리 접근에 대한 동기화 문제를 책임져야 한다.
