# 3장 | 컴퓨터 시스템의 동작 원리

## 1. 컴퓨터 시스템의 구조

- 내부 장치
    - CPU
    - 메모리
- 외부 장치
    - 디스크
    - 키보드
    - 마우스
    - 모니터

## 2. CPU 연산과 I/O 연산

- CPU - 컴퓨터 내에서 수행되는 연산을 담당
- 입출력 컨트롤러 - 입출력 장치들의 I/O 연산을 담당
- 각각의 공간에서 동시에 작업이 수행 될 수 있다.
- 로컬 버퍼(local buffer) - 각 장치마다 이를 제어하기 위해 설치된 장치 컨트롤러는 장치로부터 들어오고 나가는 데이터를 임시로 저장하기 위한 작은 메모리를 가지고 있다.

## 3. 인터럽트의 일반적 기능

- 인터럽트(interrupt) - 컨트롤러들이 CPU의 서비스가 필요할 때 이를 통보하는 방법을 말한다.
- 프로그램이 요청한 데이터를 디스크 컨트롤러가 로컬버퍼로 읽어온 후 인터럽트를 발생시키면 CPU는 인터럽트가 들어옴을 인지하고 인터럽트 관련 업무를 수행한다.
- 하드웨어 인터럽트 - 컨트롤러 등 하드웨어 장치가 CPU의 인터럽트 라인을 세팅
- 소프트웨어 인터럽트 - 소프트웨어가 CPU의 인터럽트 라인을 세팅
    - 트랩 이라고도 불린다.
    - 예시 : 예외상황, 시스템 콜
- 인터럽트 백터(interrupt vector) - 인터럽트 종류마다 번호를 정해서, 번호에 따라 처리해야 할 코드가 위치한 부분을 가리키고 있는 자료구조

## 4. 인터럽트 핸들링

- 인터럽트 핸들링(interrupt handling) - 인터럽트가 발생한 경우에 처리해야 할 일의 절차를 의미
- 프로세스 제어블록(Process Control Block: PCB) - 운영체제가 현재 시스템 내에서 실행되는 프로그램들을 관리하기 위해 두는 자료구조
    - 각각의 프로그램 마다 하나씩 존재하며 해당 프로그램의 어느 부분이 실행 중이었는지를 저장함.
    - 구체적으로 프로그램이 실행 중이던 코드의 메모리 주소, 레지스터 값, 하드웨어 상태 등

## 5. 입출력 구조

- 입출력(I/O) - 컴퓨터 시스템이 컴퓨터 외부의 입출력 장치들과 데이터를 주고받는 것
    - 동기식 입출력(synchronous I/O) - 어떤 프로그램이 입출력 요청을 했을 때 입출력 작업이 완료된 후에 그 프로그램이 후속작업을 수행할 수 있는 방식
        - CPU가 입출력 연산이 끝날 때 까지 인터럽트를 기다리며 자원을 낭비함.
        - 장치별 입출력 처리를 기다리는 프로세스를 줄 세워 관리함으로써 동기성을 보장
    - 비동기식 입출력 - 입출력 연산으르 요청한 후에 연산이 끝나기를 기다리는 것이 아니라 CPU의 제어권을 입출력 연산을 호출한 그 프로그램에게 곧바로 다시 부여하는 방식
        - 입출력과 상관없는 작업을 먼저하고 읽어오는 데이터가 반드시 필요한 작업은 입출력을 기다렸다 작업을 실행한다.

## 6. DMA

- 모든 메모리 접근 연산이 CPU에 의해서만 이루어질 경우 입출력 장치가 메모리 접근을 원할 때마다 인터럽트에 의해 CPU의 업무가 방해받게되어 CPU 사용의 효율성이 떨어진다.
- DMA(Direct Memory Access) - 일종의 컨틀롤러로서, CPU가 입출력 장치들의 메모리 접근 요청에 의해 자주 인터럽트 당하는 것을 막아주는 역할을 한다.
- 로컬 버퍼에서 메모리로 읽어오는 작업을 CPU가 아닌 DMA가 대행한다.
- DMA는 블록 단위로 메모리를 읽어온 후에 CPU에게  인터럽트를 발생시켜 해당 작업의 완료를 알린다.

## 7. 저장장치의 구조

- 주기억 장치 - 메모리라고 부르며 전원이 나가면 모든 데이터가 날라간다. → 휘발성 메모리
- 보조기억 장치 - 전원이 나가도 데이터가 유지되는 → 비휘발성 메모리
    - 용도
    - 파일 시스템용 - 메모리는 휘발성이기 때문에 저장해둘 디스크를 파일 시스템용으로 사용
    - 스왑 영역용 - 운영체제가 프로그램 수행에 당장 필요한 부분만 메모리에 올려놓고 그렇지 않은 부분은 디스크의 스왑 영역에 내려놓게 된다. → 스왑 아웃 시킨다는 표현을 사용
    - 대표적인 예 - 하드디스크
        - 여러 개의 마그네틱 원판, 디스크 원판의 표면은 트랙으로 나뉘고, 각 트랙은 섹터로 나뉜다.
        - 암 - 이동하며 원판에 저장된 데이터를 읽고 쓰는 방식

## 8. 저장장치의 계층 구조

!https://images.velog.io/images/jehjong/post/c00204d2-186d-4ad1-aefb-f6260e129ecb/image.png

- 상위 저장장치 계층으로 갈수록 접근 속도가 월등히 빠르지만 용량은 상대적으로 적다.
- 당장 필요한 정보만을 선별적으로 저장하면 하위에 있는 큰 용량의 저장장치를 가지고 있는 것과 비슷한 성능 효과를 낼 수 있다. → 캐싱 기법

## 9. 하드웨어의 보안

- 하드웨어적 보안을 유지하기 위해서 운영체제는 기본적으로 커널모드와 사용자모드를 지원한다.
- 커널모드 - 운영체제가 CPU의 제어권을 가지고 운영체제 코드를 실행하는 모드로서, 이 모드에서는 모든 종류의 명령을 다 실행할 수 있다.
- 사용자모드 - 일반 사용자 프로그램이 실행되며 제한적인 명령만 수행할 수 있다.
- 시스템에 중요한 영향을 끼치는 연산은 커널모드에서만 가능하도록 함으로써 하드웨어적 보안을 유지한다.
- 모드비트(mode bit) - 컴퓨터 시스템은 CPU 내부에 모드비트를 두어 사용자 프로그램을 감시한다.
    - 0이면 커널모드 1이면 사용자 모드
    - CPU는 보안과 관련된 명령을 수행하기 전에는 항상 모드비트를 조사해 그 값이 0인 경우에만 수행한다.

## 10. 메모리 보안

- 여러 프로그램이 메모리에 동시에 올라가서 실행되기 때문에 하나의 사용자 프로그램이 다른 사용자 프로그램이나 운영체제가 위치한 메모리 영역을 침범할 수 있기 때문에 메모리에 대한 보안도 필요하다.
- 2개의 레지스터를 두어 프로그램이 접근하려는 메모리 부분이 합법적인지 체크하여 메모리를 보호할 수 있다.
    - 기준 레지스터 (base register) - 어떤 프로그램이 수행되는 동안 그 프로그램이 합법적으로 접근할 수 있는 메모리상의 가장 작은 주소를 보관
    - 한계 레지스터 (limit register) - 프로그램이 기준 레지스터 값부터 접근할 수 있는 메모리의 범위를 보관하고 있다.
    - 즉 어떤 프로그램이 실제 메모리에 올라가 있는 부분의 시작 주소와 그 프로그램의 길이를 각각 기준 레지스터와 한계 레지스터에 보관해 메모리 접근 연산이 있을 때마다 하드웨어적으로 현재 접근하는 위치가 합법적인 범위에 있는지 체크한다.
    - 이 두개의 레지스터는 사용자 프로그램은 값을 변경할 수 없고 오직 운영체제가 직접 세팅해준다.

## 11. CPU 보호

- 특정 프로그램이 CPU를 독점해 무한반복문을 수행하는 등 부적절한 방법으로 CPU의 사용권한을 독점하고 있다면 다른 프로그램 및 운영체제가 CPU를 빼았을 방법이 없게된다.
- CPU가 하나의 프로그램에 의해 독점되는 것을 막기 위해 운영체제는 타이머(timer)라는 하드웨어를 사용한다.
- 타이머는 정해진 시간이 지나면 인터럽트를 발생시켜 운영체제가 CPU의 제어권을 획득할 수 있도록 하는 역할을 수행한다.
- 시분할 시스템에서 현재 시간을 계산하기 위해서 사용된다.

## 12. 시스템 콜을 이용한 입출력 수행

- 시스템 콜 - 일종의 소프트웨어적인 인터럽트로서 사용자 프로그램이 시스템 콜을 할 경우 트랩이 발생해 CPU의 제어권이 운영체제로 넘어가게 된다.
- 시스템 콜이 디스크 입출력 요청이었으면 디스크 컨트롤러에게 입출력 요청을 수행하도록 명령하고, 추후에 디스크 컨트롤러가 입출력 수행을 마치면 CPU에게 인터럽트를 발생시켜 입출력이 완료되었음을 알려줌으로써 해당 프로그램이 다시 CPU를 할당 받을 수 있도록 한다.
