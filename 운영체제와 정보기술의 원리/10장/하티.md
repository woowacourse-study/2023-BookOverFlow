# 10. 웹캐싱 기법

## 웹캐싱 (Web caching)

- 캐싱: 단일 시스템 내의 저장장치 계층 간의 속도 차이를 완충시켜주기 위해,
    
    컴퓨터 구조.운영체제.데이터베이스 등의 분야에서
    
    캐시 메모리.페이징 기법.버퍼링 기법 등으로 연구되어 왔다.
    
- 웹의 보편화, 컨텐츠 전송 네트워크 (CDN) 서비스의 활성화 → 기존 캐싱뿐 아니라 **원격지의 객체를 캐싱하는 기법의 중요성 증가**
    - 특히, 웹서비스의 오랜 지연시간, 네트워크의 병목현상 등을 완화시키기 위해서
- `웹캐싱`: 기하급수적으로 늘어나는 인터넷 정보에 신속히 접근할 수 있게 하는 주요 기술 중 하나로,
    
    웹 사용자에 의해 빈번히 요청되는 데이터를 사용자와 지리적으로 가까운 웹캐시 서버에 보관해
    
    빠른 서비스를 가능하게 하는 기법
    
    - 웹서버 또는 웹 사용자 차원, 그리고 웹캐싱만을 전담하는 프락시서버에 의해 광범위하게 이루어짐
    - 프락시서버 - (1) 일개 그룹의 웹 사용자에 대한 서비스 지연시간 감소, (2) 네트워크 대역폭 절약과 함께 웹서버 부하를 줄이는 역할
    - 역방향 프락시캐시 - 일개 그룹에 속한 웹서버의 객체들을 캐싱하여 서버의 부하를 줄이고, 웹 사용자의 지연시간 감소
- 캐싱 시스템의 성능 → **캐시 교체 알고리즘**
- 캐싱 시스템은 **일관성 유지 기법**을 필요로 한다.
    - 사용자가 요청한 웹 객체가 캐싱되어 있는 경우, 근원지 서버에 있는 객체와 동일한지 확인 → 사용자에게 최신 정보를 전달
    - 일관성 유지 여부가 큰 문제가 되진 않는 경우가 대부분이고, 불일치에 대한 의미에 차이가 조금 있다.

## 웹캐시의 교체 알고리즘

- 캐싱 기법의 성능을 결정하는 주요 요인
- 한정된 캐시 공간을 가지고 사용자들의 지속적인 요청을 처리하기 위해 어떤 객체를 캐시에 보관하거나 삭제할지 동적으로 온라인으로 결정하는 알고리즘
- 근원지 서버의 위치 및 특성에 따라 캐시를 읽어오는 비용이 달라지고, 파일 단위의 캐싱이므로 크기 균일하지 않음 → 객체의 이질성을 고려해야 함

### 교체 알고리즘의 성능 척도

- 캐시적중률(Hit Rate: HR): 사용자의 총 요청 중 캐시에서 적중되어 서비스된 요청의 비율
- 객체들의 크기와 인출 비용이 균일하지 않으므로, 객체들의 참조 가능성과 이질성을 함께 고려해서 객체들의 가치를 평가하는 것이 바람직
    
    → 캐싱의 목표는 비용절감률 (Coat-Savings Ratio: CSR) !? 
    

### 참조 가능성의 예측

- 미래의 참조를 미리 알지 못하는 상태에서 미래에 참조될 가능성이 높은 객체를 선별해 한정된 캐시 공간에 보관하는 것
    - 미래의 참조 가능성을 얼마나 잘 예측하느냐에 따라 효율성이 좌우됨
- 과거 참조 기록에 의한 방법
    - 캐싱된 객체의 최근 참조 성향과 참조 빈도에 근거해 미래의 참조 성향을 예측하는 방법
- 교체 알고리즘
    - LRU: 최근 참조 성향 고려 **→ 시간지역성**: 최근 참조되면 다시 참조될 가능성 높음
    - LFU: 참조 횟수 고려 **→ 인기도**: 참조 횟수가 많을수록 다시 참조될 가능성 높음
    - LRU-K, LRFU: 최근 참조 성향, 참조 횟수 고려

### 객체의 이질성에 대한 고려

- 기존 전통적인 캐싱 방법과 달리, 참조 가능성 외의 **객체의 크기와 인출 비용**을 고려해야 함
- 즉, **객체의 참조 가능성에 의한 가치**와 **캐시에서 적중될 경우 실제로 절약할 수 있는 비용**을 동시에 고려해야 함
- 캐시적중률을 높이기 위해서 크기가 작은 객체에 높은 가치를 부여
    - 많은 객체를 보관하면 캐시적중률 증가
- 비용절감률을 증가시키기 위해
    
    (1) 참조 가능성에 대한 예측치 * 객체의 단위 크기당 비용 = 객체의 전체적인 가치를 평가하는 방법
    
    (2) 노화 메커니즘 (시간의 흐름에 따라 참조되지 않은 객체의 가치를 감소시킴) 을 모든 객체들에 대해 동일한 값으로 적용시킴
    

### 알고리즘의 시간 복잡도

- 캐싱 알고리즘은 온라인 알고리즘 → 빈 공간이 필요할 때마다 즉시 삭제할 객체를 선별해야 함
- 프락시캐시 내에 수십만~수백만 개의 객체 존재 … O(n)은 부담이 아주 크다!
    - `O(logn)`을 넘지 않는 것이 바람직

## 웹캐시의 일관성 유지 기법

- 캐싱된 웹 객체가 근원지 서버에서 변경될 수 있으므로, 웹캐시에는 사용자에게 유효한 정보를 전달하기 위한 일관성 유지 기법이 필요하다.
- 다만, 일관성이 불일치해도 큰 문제가 발생하지 않는 경우가 대부분
    - **약한 일관성 유지 기법** 사용 : `적응적 TTL (adaptive time-to-live)` 기법
    - 사용자의 요청이 있을 때마다 확인 X, 변경되었을 가능성이 높은 경우에만 확인하는 기법을 말한다.
    - **강한 일관성 유지** **기법** : 반드시 최신 정보가 사용자에게 전달되는 것을 보장하는 기법
        - 웹캐싱에서는 강한 일관성 유지 기법을 사용할 경우 이로인한 웹서버와 네트워크 부담이 큼 → 득보다는 실..
- 웹캐시의 일관성 유지를 위한 전형적인 기법들
    - polling-every-time: 캐시 내에 이미 존재하는 객체에 대한 요청이 있을 때마다 근원지 서버에 객체의 변경 여부를 확인하는 방법
    - invalidation: 근원지 서버가 자신의 객체를 캐싱하고 있는 모든 프락시서버를 기록해두었다가 해당 객체가 변경된 경우 해당 프락시서버들에 변경 사실을 알려주는 방법
    - adaptive TTL: 캐시 내에 이미 존재하는 객체에 대한 요청이 있을 때, 해당 객체에 대한 최종 변경 시각과 최종 확인 시각을 고려해 변경되었을 가능성이 높다고 판단되는 경우에 근원지 서버에 변경 여부를 확인하는 방법

## 웹캐시의 공유 및 협력 기법

- 웹캐싱의 효과 극대화 → 웹캐시 간의 공유 및 협력 기법 필요
- 웹캐시 간의 공유는 **인터넷 캐시 프로토콜 (Internet Cache Protocol: ICP)** 에 의해 이루어짐
    - ICP: 동료 프락시캐시들 사이에서 웹 객체의 검색 및 전송을 지원하기 위한 프로토콜
    - 프락시서버에 웹 객체 요구 → 객체를 캐싱하고 있지 않은 경우, ICP에서 모든 동료 프락시들에게 ICP 질의를 멀티캐스트 → 누가 요청된 웹 객체를 갖고 있는지 확인 → 갖고 있다는 응답이 오면, HTTP 요청을 보내 객체를 받아온 후 사용자에게 전달
    - HTTP: 웹 객체의 전송을 위한 프로토콜
        
        ICP: 공유 웹캐시들 간에 객체의 위치를 확인하기 위한 프로토콜, HTTP에 의해 부담이 적은 프로토콜
        
- **캐시 배열 간 경로지정 프로토콜 (Cache Array Routing Protocol: CARP)**
    - 공유 웹캐시들에 동일한 웹 객체들의 중복 저장 방지 위해서, URL 공간을 분할해 각각의 캐시는 자신에게 배정되는 객체들만 캐싱하도록 함
- **디렉토리 기반 프로토콜 (directory based protocol)**
    - 공유 웹캐시에 저장된 객체들의 위치 정보를 디렉토리에 유지함으로써 ICP 및 관리에 또 다른 부담이 생기게 된다.
    - 디렉토리는 공유 프락시 자체 or 별도의 디렉토리 서버에 구현, 서버 부하 부담을 줄이기 위해 여러 개의 디렉토리 서버를 두기도 한다.

## 웹캐시의 사전인출 기법

- 웹서비스의 응답 지연시간을 줄이기 위한 방법의 일환
- 사용자에 의해 **아직 요청되지 않은 객체를 미리 받아오는** `사전인출 기법(prefetching)`의 중요성이 증가하고 있다.
- 예측 사전인출 기법 (predictive prefetching)
    - 웹페이지들 간의 관계 그래프를 구성, 하나의 웹 페이지가 참조되었을 때 새로운 웹페이지가 참조될 확률을 과거 기록을 통해 예측, 이 확률을 기반으로 사전인출을 수행하는 방법
- 대화식 사전인출 기법 (interactive prefetching)
    - HTML 문서에 대한 요청 → 웹캐시는 캐싱하고 있던 HTML 문서를 미리 파싱(parsing)해 그 문서에 포함(embed)되거나 연결(link)된 웹 객체를 미리 받아와서 사용자의 후속 요청에 곧바로 전달하는 기법
- 유효성의 사전확인 기법 연구도 이루어지고 있다.
    - 캐싱된 객체의 유효셩을 미리 확인해두었다가, 사용자가 요청하면 웹서버에 변경 여부를 확인하지 않고 곧바로 보내주는 방법

## 동적 웹 객체의 캐싱 기법

- 실시간으로 변하지 않는 데이터 — HTML, JPG, GIF 등 — **정적 웹 콘텐츠 (static web contents)** 에 대한 캐싱
- 실시간성을 요구하는 콘텐츠 — ASP, CGI 등 — **동적 웹 콘텐츠 (dynamic web contents)**에 대한 캐싱
- 지금까지 설명한 웹캐싱 기법들은 전자에 초점 / 그러나 후자를 처리하는 부분이 전체 웹서비스 지연시간 중 상당한 부분을 차지하고, 웹서버의 과부하를 일으키는 주요 원인
- 정적 웹컨텐츠 캐싱에 비하여, **동적 웹컨텐츠 캐싱**이 **데이터 관리에 어려움**이 있다.
    - 정적 → 요청을 받으면 저장장치에 있는 파일 그대로 보내줌
    - 동적 → 요청을 받으면 프로그램을 실행한 후 결과물을 보내줌
- 동적 웹콘텐츠에 대한 요청의 결과물이 항상 다르지만 유사한 부분들을 포함하고 있기 때문에, 부분적으로 캐싱하여 활용할 수 있다.