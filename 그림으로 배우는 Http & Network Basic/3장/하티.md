# 03. HTTP 정보는 HTTP 메시지에 있다

## HTTP 메시지

- HTTP에서 교환하는 정보
- 리퀘스트 메시지, 리스폰스 메시지

### 메시지 구조

```
메시지 헤더
    리퀘스트 라인 / 상태 라인  - 리퀘스트 URI or 상태 코드, HTTP 버전
    리퀘스트/리스폰스 헤더 필드
    일반 헤더 필드
    엔티티 헤더 필드
    그 외..

개행 문자 [CR+LF]

메시지 바디
```

## 인코딩으로 전송 효율 높이기

- 장점: 다량의 액세스 전송 효율 높아짐
- 단점: 인코딩 처리를 위한 CPU 리소스 소비

### 메시지 바디 vs 엔티티 바디

- message: HTTP 통신의 기본 단위, 통신을 통해 전송됨
- entity: 리퀘스트와 리스폰스의 payload로 전송되는 정보, [헤더 필드 + 엔티티 바디]로 구성
- http message body의 역할은 entity body를 운반하는 일
- message body ≠ entity body 인 경우: 전송 코딩이 적용된 경우

### 콘텐츠 코딩

- 엔티티에 적용하는 인코딩
- 엔티티 정보를 유지한 채로 압축하고, 클라이언트 측에서 디코딩한다.

### 청크 전송 코딩

- 사이즈가 큰 데이터를 분할하는 기능
- 분할함으로써 브라우저에 조금씩 표시할 수 있다.
- 엔티티 바디를 청크 단위로 분해
    - 청크 사이즈를 16진수로 단락 표시
    - 엔티티 바디 끝에 0(CR+LF) 기록
- 클라이언트 측에서 디코딩

## 멀티파트 (Multipart)

- MIME (Multipurpose Internet Mail Extensions) 확장 사양에 있는 멀티파트 : 여러 다른 종류의 데이터를 수용하는 방법
- HTTP 역시 멀티파트에 대응
    - 메시지 바디 내부에 엔티티를 여러 개 포함하여 전송 가능
    - 주로 이미지, 텍스트 파일 등을 업로드할 때 사용
- 멀티파트 종류
    - `multipart/form-data` : web 폼으로부터 파일 업로드에 사용
    - `multipart/byteranges` : 상태 코드 206 리스폰스 메시지가 복수 범위의 내용을 포함할 때

## 레인지 리퀘스트 (range request)

- resume 기능을 이용하기 위해, 엔티티의 범위를 지정해서 리퀘스트 (다운로드) 하는 방법
    - 대용량의 데이터를 다운로드하는 중, 커넥션이 끊어져도 처음부터 다시 다운로드가 아니라 재개할 수 있도록 하기 위해
- 전체 10,000 바이트 정도 크기의 리소스에서 5,000 ~ 10,000 바이트 레인지 만을 리퀘스트 할 수 있음
- 레인지 리퀘스트에 대한 리스폰스는 상태코드 206, `multipart/byteranges`로 되돌아 옴

## 콘텐츠 네고시에이션 (Content Negotiation)

- 같은 콘텐츠이지만 여러 개의 페이지를 표시하는 구조
    - e.g. google → 한국 브라우저에서는 한국어, 영어 브라우저에서는 영어 페이지가 표시됨
- 클라이언트와 서버가 제공하는 리소스의 내용에 대해서 교섭하는 것
- 클라이언트에 **더욱 적합한 리소스를 제공하기 위한 구조**

### 서버 구동형 네고시에이션 (Server-driven Negotiation)

- 서버 측에서 콘텐츠 네고시에이션을 하는 방식
    - 리퀘스트 헤더 필드의 정보를 참고해서 자동적으로 처리함
- 브라우저가 보내는 정보를 근거
    - 유저에게 정말로 적절한 가는 보장할 수 없음

### 에이전트 구동형 네고시에이션 (Agent-driven Negotiation)

- 클라이언트 측에서 콘텐츠 네고시에이션을 하는 방식
- 브라우저에 표시된 선택지를 유저가 수동으로 선택 or 웹 페이지에서 자동으로 정함
    - e.g. JS 등을 사용하여 OS 종류나, PC화면이나 모바일화면으로 전환해주는 경우

### 트랜스페어런트 네고시에이션 (Transparent Negotiation)

- 서버와 클라이언트가 각각 콘텐츠 네고시에이션을 하는 방식
- 위의 두 개 혼합형