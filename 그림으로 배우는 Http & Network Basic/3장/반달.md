# Chapter 03 HTTP 정보는 HTTP 메시지에 있다

## HTTP 메시지
> HTTP에서 교환하는 정보

- Request Message: 리퀘스트 측에서 보내는 HTTP 메시지
- Response Message: 리스폰스 측에서 보내는 HTTP 메시지

HTTP 메시지는 복수 행의 데이터로 구성된 텍스트 문자열

HTTP 메시지의 구분
- 메시지 헤더
    - 서버와 클라이언트가 꼭 처리해야 하는 리퀘스트와 리스폰스 내용과 속성 등
- 개행문자(CR+LF)
    - CR(carriage return: 16진수 0x0d)와 LF(line feed: 16진수 0x0a)
- 메시지 바디
    - 꼭 전송되는 데이터 그 자체

## 리퀘스트 메시지와 리스폰스 메시지의 구조
### 리퀘스트 메시지의 구조
- 메시지 헤더
    - 리퀘스트 라인
        - 리퀘스트에 사용하는 메소드와 리퀘스트 URI와 사용하는 HTTP 버전이 포함됨
    - 리퀘스트 헤더 필드
    - 일반 헤더 필드
    - 엔티티 헤더 필드
    - 그 외
- 개행 문자[CR+LF]
- 메시지 바디

### 리스폰스 메시지의 구조
- 메시지 헤더
    - 상태 라인
        - 리스폰스 결과를 나타내는 상태 코드와 설명, 사용하는 HTTP 버전이 포함됨
    - 리스폰스 헤더 필드
    - 일반 헤더 필드
    - 엔티티 헤더 필드
    - 그 외
- 개행 문자[CR+LF]
- 메시지 바디

## 인코딩으로 전송 효율을 높이다.
> HTTP로 데이터를 전송할 경우 그대로 전송할 수도 있지만 전송할 때에 인코딩(변환)을 실시함으로써 전송 효율을 높일 수 있다.
> 전송할 때 인코딩을 하면 다량의 액세스를 효율 좋게 처리할 수 있다. 단지, 컴퓨터에서 인코딩 처리를 해야하기 때문에 CPU 등의 리소스는 보다 많이 소비하게 된다.

메시지 바디와 엔티티 바디의 차이
- 메시지(message)
    - HTTP 통신의 기본 단위로 옥텟 시퀀스로 구성되고 통신을 통해서 전송됨
- 엔티티(entity)
    - 리퀘스트랑 리스폰스의 페이로드로 전송되는 정보로 엔티티 헤더 필드와 엔티티 바디로 구성됨

  HTTP 메시지 바디의 역할은 리퀘스트랑 리스폰스에 관한 엔티티 바디를 운반하는 일이다.
  기본적으로 메시지 바디와 엔티티 바디는 같지만 전송 코딩이 적용된 경우에는 엔티티 바디의 내용이 변화하기 때문에 메시지 바디와 달라진다.


### 압축해서 보내는 콘텐츠 코딩
> 엔티티에 적용하는 인코딩을 가리키는데 엔티티 정보를 유지한채로 압축한다.
> 콘텐츠 코딩된 엔티티는 수신한 클라이언트 측에서 디코딩한다.

### 분해해서 보내는 청크 전송 코딩
> HTTP 통신에서는 리퀘스트 했었던 리소스 전부에서 엔티티 바디의 전송이 완료되지 않으면 브라우저에 표시되지 않는다.
> 이렇게 엔티티 바디를 분할하는 기능을 청크 전송 코딩(Chunked transfer Coding)이라고 부릅니다.

- 엔티티 바디를 청크로 분해한다.
- 청크 사이즈를 16진수로 사용해서 단락을 표시하고 엔티티 바디 끝에는 "0(CR+LF)"를 기록해둔다.
- 청크 전송 코딩된 엔티티 바디는 수신한 클라이언트 측에서 원래의 엔티티 바디로 디코딩한다.

## 여러 데이터를 보내는 멀티파트
- MIME(Multipurpose Internet Main Extensions: 다목적 인터넷 메일 확장 사양)으로 불리는 메일로 텍스트나 영상, 이미지와 같은 여러다른 데이터를 다루기 위한 기능을 사용하고 있다.

- HTTP도 멀티파트에 대응하고 있어 하나의 메시지 바디 내부에 엔티티를 여러 개 포함시켜 보낼 수 있습니다.
- 주로 이미지나 텍스트 파일 등을 업로드 할 때 사용되고 있다.

- 멀티파트에는 다음과 같은 것이 있습니다.
    - multipart/form-data
        - Web 폼으로 부터 파일 업로드에 사용된다.
    - multipart/byteranges
        - 상태 코드 206(Partial Content) 리스폰스 메시지가 복수 범위의 내용을 포함하는 때에 사용된다.

멀티파트는 파트마다 헤더 필드가 포함된다. 또한 파트의 중간에 멀티파트를 만드는 것과 같이 파트를 내부에 포함할 수도 있다.

## 일부부만 받는 레인지 리퀘스트
> 범위를 지정하여 리퀘스트 하는 것을 레인지 리퀘스트라고 한다.

레인지 리퀘스트에 대한 리스폰스는 상태 코드 206 Partial Content 라는 리스폰스 메시지가 돌아온다.
서버가 레인지 리퀘스트에 지원하지 않는 경우엔 상태코드 200OK 라는 리스폰스 메시지로 완전한 엔티티가 되돌아 온다.

## 최적의 콘텐츠를 돌려주는 콘텐츠 네고시에이션
> 웹 페이지에서 영어와 한국어와 같이 서로 다른 언어를 주로 사용하는 브라우저가 같은 URI에 엑세스 할 때 각각 영어판 웹 페이지와 한국어 판 웹 페이지를 표시하는 구조를 콘텐츠 네고시에이션이라고 부른다.

> 콘텐츠 네고시에이션이란 클라이언트와 서버가 제공하는 리소스의 내용에 대해 교섭하는 것

판단하는 기준은 리퀘스트 메시지에 포함된 다음과 같은 리퀘스트 헤더 필드이다.
- Accept
- Accept - Charset
- Accept - Encoding
- Accept - Language
- Content - Language

### 서버 구동형 네고시에이션 (Server-driven Negotiation)
- 서버 측에서 콘텐츠 네고시에이션을 하는 방식
- 서버 측에서 리퀘스트 헤더 필드의 정보를 참고해서 자동적으로 처리
- 브라우저가 보내는 정보를 근거로 하기 때문에 정말로 유저에게 적절한 것이 선택 되었는지 알 수 없음

### 에이전트 구동형 네고시에이션(Agent - diven Negotiation)
- 클라이언트 측에서 콘텐츠 네고시에이션을 하는 방식
- 브라우저에 표시된 선택지 중에서 유저가 수동으로 선택함

### 트랜스페어런트 네고시에이션(Transparent Negotiation)
- 서버 구동형과 에이전트 구동형을 혼합한 것으로 서버와 클라이언트가 각각 콘텐츠 네고시에이션을 하는 방식
