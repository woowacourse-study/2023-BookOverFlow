# 5장 HTTP와 연계하는 웹 서버

## 5.1 1대로 멀티 도메인을 가능하게 하는 가상 호스트

HTTP/1.1에서는 하나의 HTTP 서버에 여러 개의 웹 사이트를 실행할 수 있다

- 고객마다 다른 도메인을 가지고, 다른 웹 사이트 실행

**가상 호스트**

- 물리적으로는 서버가 1대지만 가상으로 여러 대가 있는 것처럼 설정하는 것

HTTP를 사용해서 클라이언트가 서버에 액세스할 때는 호스트 명이나 도메인 명이 자주 사용

- 도메인명 → DNS에 의해서 IP 주소로 변환되고 나서 액세스 됨
- 리퀘스트가 서버에 도착한 시점에는 IP 주소를 기준으로 액세스 됨
- 이 때 1대의 서버 안에서는 어느 쪽에 대한 액세스인지 알 수 없음.

가상 호스트 시스템 사용시

- 같은 IP 주소에서 다른 호스트명과 도메인 명을 가지는 여러 개의 웹 사이트가 실행되고 있음
- HTTP 리퀘스트를 보내는 경우 호스트 명과 도메인 명 완전히 포함한 URI 지정, Host 헤더 필드에 지정

## 5.2 통신을 중계하는 프로그램: 프록시, 게이트웨이, 터널

다른 서버에 리퀘스트를 중계하고, 그 서버로부터 받은 리스폰스를 클라이언트에 반환하는 역할 담당

**프록시**

- 서버와 클라이언트의 양쪽 역할을 하는 중계 프로그램
- 클라이언트로부터 리퀘스트를 서버에 전송, 서버로부터의 리스폰스를 클라이언트에 전송

**게이트웨이**

- 다른 서버를 중계하는 서버
- 클라이언트로부터 수신한 리퀘스트를 리소스를 보유한 서버인 것처럼 수신
- 클라이언트는 상대가 게이트웨이라는 것을 알지 못하는 경우도 있음

**터널**

- 서로 떨어진 두 대의 클라이언트와 서버 사이를 중계하며 접속을 주선하는 중계 프로그램

### 5.2.1 프록시

![proxy.jpeg](https://prod-files-secure.s3.us-west-2.amazonaws.com/203d6d84-3936-4265-836e-c5aa6af877e9/ce274c46-c28a-496a-9999-67dec3393371/proxy.jpeg)

클라이언트로부터 받은 리퀘스트를 다른 서버에 전송하는 것

- 리퀘스트 URI를 변경하지 않고 리소스를 가지고 있는 서버에 보냄
- 리소스의 본체를 가진 서버 → **오리진 서버**
- 오리진 서버로부터 되돌아온 리스폰스는 프록시 서버를 경유해서 클라이언트에 돌아옴

![IMG_3950.jpg](https://prod-files-secure.s3.us-west-2.amazonaws.com/203d6d84-3936-4265-836e-c5aa6af877e9/75307504-823d-406b-b293-8b5d9214900d/IMG_3950.jpg)

HTTP 통신을 할 때, 프록시 서버 여러 대 경유 가능

- 중계할 때에는 Via 헤더 필드에 경유한 호스트 정보 추가

**프록시 서버 사용하는 이유**

- 캐시를 사용해서 네트워크 대역 등을 효율적으로 사용하는 것
- 조직 내에 특정 웹 사이트에 대한 액세스 제한
- 액세스 로그를 획득하는 정책을 철저하게 지키려는 목적으로 사용

**프록시 사용 방법**

- 캐싱 프록시(Cashing Proxy)
    - 프록시로 리스폰스 중계 시 프록시 서버 상에 리소스 캐시를 보존해 두는 타입의 프록시
    - 프록시에 같은 리소스에 리퀘스트가 오면, 오리진 서버에서 획득하는 것이 아닌 캐시를 리스폰스로서 되돌려줌
- 투명 프록시(Transparent Proxy)
    - 프록시스로 중계 시, 메시지 변경을 하지 않는 타입의 프록시
    - 메시지에 변경을 가하는 타입의 프록시 → 비투과 프록시
    - 일반적으로 투명 프록시는 회사나 부모가 기기 사용자의 온라인 활동을 모니터링하고 특정 웹사이트에 접근하지 못하도록 차단하고 싶은 경우에 사용되며 호텔과 카페는 투명 프록시를 통해 공용 와이파이에서 사용자를 인증하고 엑세스 권한을 허용한다.

### 5.2.2 게이트웨이

![IMG_3951.jpg](https://prod-files-secure.s3.us-west-2.amazonaws.com/203d6d84-3936-4265-836e-c5aa6af877e9/2c1d41b0-b17a-4b50-8659-aa284f1e7ff3/IMG_3951.jpg)

게이트웨이 다음에 있는 서버가 HTTP 서버 이외의 서비스를 제공하는 서버가 됨

클라이언트와 게이트웨이 사이를 암호화하는 등으로 안전하게 접속함으로써 통신의 안전성을 높이는 역할

ex) 쇼핑 사이트에서 신용카드 결제 시스템

### 5.2.3 터널

![IMG_3952.jpg](https://prod-files-secure.s3.us-west-2.amazonaws.com/203d6d84-3936-4265-836e-c5aa6af877e9/a5175f71-c428-4037-9d03-888cbffa63c7/IMG_3952.jpg)

- 요구에 따라서 다른 서버와의 통신 경로를 확립
- 클라이언트는 SSL 같은 암호화 통신을 통해 서버와 안전하게 통신을 하기 위해 사용
- HTTP 리퀘스트 해석하지 않음, 리퀘스트를 그대로 서버에 중계
- 통신하고 있는 양쪽 끝의 접속이 끊어질 때 종료

## 5.3 리소스를 보관하는 캐시

**캐시**

- 프록시 서버와 클라이언트의 로컬 디스크에 보관된 리소스의 사본
- 리소스를 가진 서버의 액세스를 줄일 수 있음 → 통신량과 통신시간 절약

**캐시 서버**

- 프록시 서버의 하나로 캐싱 프록시로 분류
- 프록시 서버로부터 리스폰스를 중계하는 때에 프록시 서버 상에 리소스의 사본 보존
- 캐시를 이용함으로써 같은 데이터를 몇 번이고 오리진 서버에 전송할 필요 없음

### 5.3.1 캐시는 유효기간이 있다

캐시서버에 캐시가 있어도 항상 캐시를 돌려준다고 할 수 없음

- 캐시를 가지고 있더라도 클라이언트의 요구나 캐시의 유효 기간 등에 의해서 오리진 서버에 리소스의 유효성을 확인하거나 새로운 리소스를 다시 획득하러 가게 되는 경우 있음

![IMG_3953.jpg](https://prod-files-secure.s3.us-west-2.amazonaws.com/203d6d84-3936-4265-836e-c5aa6af877e9/e256c501-9525-413a-be77-64be0c47337f/IMG_3953.jpg)

### 5.3.2 클라이언트 측에도 캐시가 있다

**인터넷 임시 파일**

- 인터넷 익스폴로러에서 클라이언트가 보존하는 캐시
- 브라우저가 유효한 캐시를 가지고 있는 경우, 같은 리소스의 액세스는 서버에 액세스하지 않고 로컬 디스크로부터 불러옴
- 리소스가 오래된 것으로 판단된 경우에는 오리진 서버에 리소스의 유효성 확인하러 가거나 새로운 리소스를 다시 획득함
